---
apiVersion: v1
kind: Service
metadata:
  name: api-port
spec:
  ports:
    - port: 5000
      protocol: TCP
      targetPort: 5000
  selector:
    name: api
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api
spec:
  selector:
    matchLabels:
      name: api
  replicas: 3
  template:
      metadata:
        labels:
          name: api
      spec:
        containers:
          - name: api
            image: piotrostr/api
            envFrom:
              - secretRef:
                  name: api-secrets
                  optional: False
            ports:
              - containerPort: 5000
            resources:
              requests:
                cpu: "100m"
                memory: "128Mi"
              limits:
                cpu: "500m"
                memory: "768Mi"
        imagePullSecrets:
          - name: regcred
        restartPolicy: Always
